/*
*********************************************************************************************************
*
*	模块名称 : MAIN函数
*	文件名称 : main.h
*	版    本 : V1.0
*	说    明 : 这是main文件包含的所有.h文件，包含调用的底层驱动、标准库等。
*			        
*	修改记录 :
*		版本号  日期         作者       说明
*		V1.0    2025-11-13    FN       正式发布
*
*	Copyright (C), 2018-2030, 蜂鸟物联网 www.armfly.com
*
*********************************************************************************************************
*/
#ifndef __MAIN_H__
#define __MAIN_H__


// 定义复位原因的枚举类型
typedef enum {
    RESET_REASON_UNKNOWN = 0,    // 未知复位原因
    RESET_REASON_POWER_ON,       // 上电复位（POR/PDR复位）
    RESET_REASON_EXTERNAL,       // 外部复位（NRST引脚低电平）
    RESET_REASON_WWDG,           // 窗口看门狗复位
    RESET_REASON_IWDG,           // 独立看门狗复位
    RESET_REASON_SOFT,           // 软件复位（NVIC_SystemReset）
    RESET_REASON_BOR             // 欠压复位（BOR）
} Reset_Reason_t;

/*
*********************************************************************************************************
*                                         Standard Libraries
*********************************************************************************************************
*/
#include <stdbool.h>
#include "string.h"
#include "stdio.h"

/*
*********************************************************************************************************
*                                        Memory Headers
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                         System Headers
*********************************************************************************************************
*/
#include "./SYSTEM/sys/sys.h"
#include "./SYSTEM/delay/delay.h"


/*
*********************************************************************************************************
*                                        BSP Modules
*********************************************************************************************************
*/
#include "bsp_led.h"
#include "bsp_usart2.h"
#include "bsp_iwdg.h"

#include "bsp_spi_flash.h"
#include "bsp_spi_bus.h"

#include "stmflash.h"
/*
*********************************************************************************************************
*                                        APP Modules
*********************************************************************************************************
*/
#include "w25qxx.h"
#include "iap.h"
/*
*********************************************************************************************************
*                                         Utility Libraries
*********************************************************************************************************
*/
#include "crc.h"

/*
*********************************************************************************************************
*                                           Definitions
*********************************************************************************************************
*/
// 升级参数存储地址
#define UPDATA_SPIFLASH_ADDR   (3*1024*1024) // W25Q128升级文件存储地址
#define UPDATA_PARAM_ADDR      (UPDATA_SPIFLASH_ADDR + (1*1024*1024) - (1*1024)) // 系统升级参数存储地址

// APP程序入口地址
#define MAIN_APP_ADDR		       0x08020000  


/*
*********************************************************************************************************
*                                        Variable definition
*********************************************************************************************************
*/
// 升级参数
struct BOOT_UPDATE_PARAM
{
	unsigned int is_update;     // true:需要升级, false:无需升级
	unsigned int section_size;  // 每包的实际数据(去掉校验2字节)大小
	unsigned int section_count; // 总包数
};

/*
*********************************************************************************************************
*                                      Function definition
*********************************************************************************************************
*/
/* 供外部调用的函数声明 */
void system_setup_function(void);
void led_gpio_init_function(void);
void led_show_control(uint8_t mode);

#endif

/****************************************** END OF FILE **********************************************/
